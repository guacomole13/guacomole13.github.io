---
/**
 * MobileMenu Component
 *
 * Off-canvas navigation menu for mobile viewports.
 * Matches desktop nav styling: [michael omole] with > FILM, > WRITING, > INFO
 * - Slides in from left
 * - Multiple exit paths: X button, backdrop, ESC, nav link click
 * - Focus trap and scroll lock handled by client script
 */

interface Props {
    pathname: string;
}

const { pathname } = Astro.props;

// Determine active section
function getActiveSection(path: string): string | null {
    if (path.startsWith("/film")) return "film";
    // if (path.startsWith("/writing")) return "writing"; // Hidden until content is ready
    if (path.startsWith("/info")) return "info";
    return null;
}

const activeSection = getActiveSection(pathname);
const isHome = pathname === "/";

const navItems = [
    { id: "film", label: "FILM", href: "/film" },
    // { id: "writing", label: "WRITING", href: "/writing" }, // Hidden until content is ready
    { id: "info", label: "INFO", href: "/info" },
];
---

<!-- Backdrop overlay -->
<div class="mobile-backdrop" id="mobile-backdrop" aria-hidden="true"></div>

<!-- Menu panel -->
<nav
    class="mobile-menu"
    id="mobile-menu"
    aria-label="Mobile navigation"
    aria-hidden="true"
>
    <!-- Close button -->
    <button
        type="button"
        class="close-btn"
        id="menu-close"
        aria-label="Close menu"
    >
        <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
        >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
    </button>

    <!-- Logo/Home link -->
    <a href="/" class="mobile-logo-link" data-nav-link>[michael omole]</a>

    <!-- Navigation links with > prefix -->
    <ul class="mobile-nav-list">
        {
            navItems.map((item) => {
                const isActive = item.id === activeSection;
                return (
                    <li>
                        <a
                            href={item.href}
                            class:list={[
                                "mobile-nav-link",
                                {
                                    "mobile-nav-link-active":
                                        isActive && !isHome,
                                },
                            ]}
                            aria-current={
                                isActive && !isHome ? "page" : undefined
                            }
                            data-nav-link
                        >
                            <span class="nav-arrow">&gt;</span>
                            {item.label}
                        </a>
                    </li>
                );
            })
        }
    </ul>
</nav>

<style>
    .mobile-backdrop {
        position: fixed;
        inset: 0;
        z-index: 150;
        background-color: rgba(0, 0, 0, 0.7);
        opacity: 0;
        visibility: hidden;
        transition:
            opacity 0.3s,
            visibility 0.3s;
    }

    .mobile-backdrop.open {
        opacity: 1;
        visibility: visible;
    }

    .mobile-menu {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        z-index: 200;
        width: 280px;
        max-width: 80vw;
        background-color: #000;
        border-right: 1px solid rgba(255, 255, 255, 0.2);
        padding: 2rem;
        display: flex;
        flex-direction: column;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }

    .mobile-menu.open {
        transform: translateX(0);
    }

    .close-btn {
        position: absolute;
        top: 1rem;
        right: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        padding: 0;
        background: none;
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        cursor: pointer;
        transition: border-color 0.2s;
    }

    .close-btn:hover {
        border-color: white;
    }

    /* [michael omole] logo style - matches desktop */
    .mobile-logo-link {
        font-size: 0.9rem;
        font-weight: 400;
        letter-spacing: 0.02em;
        color: white;
        text-decoration: none;
        text-transform: lowercase;
        margin-top: 3rem;
        margin-bottom: 1.5rem;
    }

    .mobile-logo-link:hover {
        opacity: 0.7;
    }

    .mobile-nav-list {
        list-style: none;
        padding: 0;
        margin: 0;
        padding-left: 0.5rem; /* Indent under logo like desktop */
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .mobile-nav-link {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        font-weight: 400;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        transition: color 0.2s;
    }

    .nav-arrow {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.5);
    }

    .mobile-nav-link:hover,
    .mobile-nav-link:focus {
        color: white;
    }

    .mobile-nav-link:hover .nav-arrow,
    .mobile-nav-link:focus .nav-arrow {
        color: white;
    }

    .mobile-nav-link-active {
        color: white;
        font-weight: 600;
    }

    .mobile-nav-link-active .nav-arrow {
        color: white;
    }
</style>
